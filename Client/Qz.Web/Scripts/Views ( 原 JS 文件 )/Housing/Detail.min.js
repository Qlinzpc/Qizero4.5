var detail=new function(){function r(n){var t=$api.dom(n,"ul"),r=(t.clientWidth-9)/2/1.13-1;detail.img.fontSize=r+"px";$api.css($api.domAll(t,".fa-picture"),"font-size:"+detail.img.fontSize);i=1}function u(t){if(n=1,t){var i={url:"/Housing/DetailTelData",data:'{ "UserId": "'+req.userId+'","HousingId": "'+req.id+'","Source": "'+req.source+'","Type": "2" }'};common.ajax.post({contentType:"application/json",url:i.url,data:i.data,callback:function(n){if(n.Status!=0){common.tip(n.Message);return}common.tip("查看电话已记录成功 !");$api.text("tel-number",n.Obj.OwnerTel);$api.data("tel","tel",n.Obj.OwnerTel)}})}}var t,i,n;this.ajax={url:"/Housing/DetailData",data:{UserId:req.userId,HousingId:req.id,source:req.source||0}};this.data={Lng:"114.031024",Lat:"22.541168"};this.load=function(){t.event();t.data("detail");weix.create()};t={event:function(){$api.addEvt("btn-more","click",function(){var r=$api.text(this),n=$api.domAll(".more"),t=n.length,i;r=="查看更多详细消息>>"?$api.text(this,"隐藏更多详细消息>>"):$api.text(this,"查看更多详细消息>>");i=setInterval(function(){if($api.toggleCls(n[--t],"dn"),t<=0){clearInterval(i);return}},50)});$api.addEvt($api.domAll(".nav .btn"),"click",function(){var t=$api.data(this,"target"),f=$api.domAll(".nav .btn"),e=$api.domAll(".info");$api.removeCls(f,"select");$api.addCls(this,"select");$api.addCls(e,"dn");$api.removeCls(t,"dn");t!="tel-info"&&(n=0);detail.img.isShow=!1;t=="pic-info"&&(detail.img.isShow=!0,i==0&&(r(t),detail.img.load()));t=="tel-info"&&n==0&&u($api.val("showTel")=="1")});$api.addEvt($api.dom(".content"),"scroll",function(){if(common.top.init(this),detail.img.isShow&&detail.img.getUploadLen()>0){var n=$api.dom("#pic-info");this.scrollTop>=n.offsetTop*.4?$api.show("upload"):$api.hide("upload")}});$api.addEvt($api.domAll("#pic-info .fa-picture"),"click",detail.img.choose);$api.addEvt("upload","click",detail.img.upload);$api.addEvt($api.domAll("#pic-info img"),"click",detail.img.preview)},data:function(n){common.ajax.post({url:detail.ajax.url,data:detail.ajax.data,callback:function(t){var u,i,f,r;if(t.Status!=0){common.tip(t.Message);return}for(detail.data=t.Obj,u=$api.domAll(n,"span[data-bind]"),r=0;r<u.length;r++){if(i=u[r],f=$api.data(i,"bind"),f=="Id"){$api.text(i,req.id);continue}$api.text(i,detail.data[f]||"")}map.create()}})}};this.img=new function(){function i(n){n=n||0;n>0&&($api.show("upload"),$api.text("upload","上传图片 "+n));n==0&&$api.hide("upload")}function r(i){for(var u=-1,r=0;r<t;r++)if(item=n.uploadData[r],item.type==i){u=r;break}u!=-1&&(n.uploadData.splice(u,1),t=n.uploadData.length)}var n={uploadData:[],serverData:[]},t=n.uploadData.length;this.fontSize="150px";this.isShow=!1;this.isOpen=!1;this.asrc=["http://isz.zlhome.com/upLoad/HouseInfos/2015/3/17/0e86533f-3942-43ed-b18a-30fe30d0090a/3.jpg","http://isz.zlhome.com/upLoad/HouseInfos/2014/12/19/62604e45-2c47-49c4-9a72-bd8ec274cec5/3.jpg","http://isz.zlhome.com/upLoad/HouseInfos/2015/1/4/a1aad13e-70c4-436d-babc-7aac98430bcc/3.jpg","http://isz.zlhome.com/upLoad/HouseInfos/2015/3/18/4b84bcdb-6aa3-4b2e-9b28-f61645d3f0b2/3.jpg","http://isz.zlhome.com/upLoad/HouseInfos/2015/3/21/8bdc72dd-d37b-487f-8529-e281a7baf2f2/3.jpg","http://isz.zlhome.com/upLoad/HouseInfos/2014/11/26/25ec8906-5860-41b7-a326-ed349c46ab56/3.jpg","http://isz.zlhome.com/upLoad/HouseInfos/2014/11/26/35967000-2e54-4856-b5e5-03cdb3256bda/3.jpg"];this.load=function(){var n={url:"/Housing/PictureData",data:'{ "UserId": "'+req.userId+'","HousingId": "'+req.id+'" }'};common.ajax.post({contentType:"application/json",url:n.url,data:n.data,callback:function(n){var o;if(n.Status!=0){common.tip(n.Message);return}for(var u=n.Obj.Data,t,s=u.length,i=0,f,r,e,i=0;i<s;i++)t=u[i],f=detail.img.get(t.Type),r=f.parentNode,e=r.clientHeight,$api.html(r,'<img style="height:'+(e-50)+'px" data-type="'+t.Type+'" src="'+$api.val("serverImgUrl")+t.Url+$api.val("showImg")+'" onclick="detail.img.preview.apply(this)" /><span>'+$api.trim($api.text(r))+"<\/span>"),detail.img.asrc.push($api.val("serverImgUrl")+t.Url+$api.val("previewImg"));o=setTimeout(function(){weix.config();clearTimeout(o)},500)}})};this.choose=function(){if(detail.img.isOpen){common.tip("打开中, 请稍后 !");return}var e=this,u=this.parentNode,s=u.clientWidth,o=u.clientHeight,f=$api.data(e,"type");wx.checkJsApi({jsApiList:["chooseImage"],success:function(){common.tip("打开中, 请稍后 !");detail.img.isOpen=!0;wx.chooseImage({success:function(e){if(cnt=e.localIds.length,cnt>1){common.tip("只能选择 1 张图片, 已选择 "+cnt+" 张图片 !",3500);return}r(f);$api.html(u,'<img style="height:'+(o-50)+'px" data-type="'+f+'" src="'+e.localIds[0]+'" onclick="detail.img.choose.apply(this)" /><span>'+$api.trim($api.text(u))+'<\/span><i class="fa fa-del animated slideInDown" onclick="detail.img.del(this,'+f+');"><\/i>');n.uploadData.push({id:e.localIds[0],type:f});t=n.uploadData.length;i(t);detail.img.isOpen=!1},fail:function(n){common.tip(JSON.stringify(n));detail.img.isOpen=!1}})},fail:function(n){common.tip(JSON.stringify(n));detail.img.isOpen=!1}})};this.upload=function(){function f(){u=n.uploadData[r];wx.uploadImage({localId:u.id,success:function(e){r++;try{if(common.tip("已上传 "+r+" / "+t),n.serverData.push('{ "Type": "'+u.type+'", "MediaId": "'+e.serverId+'" }'),r<t)f();else if(r==t){var o={url:"/Housing/PictureUpload",data:'{ "UserId":"'+req.userId+'","HousingId":"'+req.id+'","Data": ['+n.serverData.join(",")+"] }"};common.ajax.post({contentType:"application/json",url:o.url,data:o.data,timeout:2e4,callback:function(t){var r,u=r=0;if(t.Status==2){common.tip(t.Message);return}n.uploadData=[];i(0);common.tip(t.Message,3500)},error:function(n){common.tip(n)}})}else common.tip("上传失败, 请重新上传 !")}catch(s){common.tip(s.message)}},fail:function(n){common.tip(JSON.stringify(n))}})}var r=0,u;n.serverData=[];f()};this.preview=function(){wx.previewImage({current:$api.attr(this,"src"),urls:detail.img.asrc})};this.del=function(n,u){var f=n.parentNode;$api.html(f,'<i data-type="'+u+'" style="font-size:'+detail.img.fontSize+'" class="fa fa-picture" onclick="detail.img.choose.call(this)"><\/i><span>'+$api.trim($api.text(f))+"<\/span>");r(u);i(t);common.tip("已成功删除 !")};this.get=function(n){var t=$api.dom("#pic-info");return $api.dom(t,'li i[data-type="'+n+'"]')||$api.dom(t,'li img[data-type="'+n+'"]')};this.getUploadLen=function(){return n.uploadData.length}};i=0;n=0},map=new function(){this.create=function(){var n=setTimeout(function(){clearTimeout(n)},200)};this.init=function(){var n=new BMap.Map("map"),t,i;n.centerAndZoom(new BMap.Point(detail.data.Lng,detail.data.Lat),18);n.addControl(new BMap.ZoomControl);t=new BMap.Marker(new BMap.Point(detail.data.Lng,detail.data.Lat));n.addOverlay(t);n.addEventListener("click",function(){});common.tip("baidu map api 加载完毕");i=setInterval(function(){$api.dom(".anchorBL")&&(n.disableDragging(),$api.hide(".anchorBL"),clearInterval(i))},500)}},weix=new function(){this.create=function(){common.loadJC("http://res.wx.qq.com/open/js/jweixin-1.0.0.js?jcallback=weix.init")};this.init=function(){wx.ready(function(){});wx.error(function(n){alert(n.errMsg)})};this.config=function(){var n={url:"/Common/WeiXinAPI",data:{userId:req.userId}};common.ajax.post({url:n.url,data:n.data,callback:function(n){var t=n.appId,i=n.timestamp,r=n.nonceStr,u=n.signature;wx.config({debug:!1,appId:t,timestamp:i,nonceStr:r,signature:u,jsApiList:["checkJsApi","chooseImage","previewImage","uploadImage","downloadImage","openLocation","getLocation","hideOptionMenu","showOptionMenu"]})}})}};common.loadCallback=function(){detail.load()};
//# sourceMappingURL=Detail.min.js.map
