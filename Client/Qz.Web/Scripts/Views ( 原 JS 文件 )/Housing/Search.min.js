var form=new function(){this.init=function(){for(var t=$api.domAll(".txt-flag"),f=t.length,i={},r=0,u=0,n=0,n=0;n<f;n++)i=$api.byId($api.data(t[n],"target")),$api.addCls(i.parentNode,"pos-r"),r=i.offsetLeft+i.clientWidth-t[n].clientWidth-5,u=i.offsetTop+i.clientHeight-t[n].clientHeight-t[n].clientHeight/2+1,$api.css(t[n],"left:"+r+"px;top:"+u+"px;width:"+t[n].clientWidth+"px")};this.validate=function(n){for(var r=$api.byId(n),t,i=0;i<r.length;i++)if(t=r[i],(t.localName=="textarea"||t.localName=="input"&&t.type!="button"&&t.type!="submit"&&t.type!="reset")&&!t.validity.valid){if("float"==$api.data(t,"validate-type")){if(!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test(t.value))return common.tip("只能为整数或小数"),t.focus(),!1;continue}return common.tip(t.validationMessage),t.focus(),!1}return!0};this.condition=function(id){for(var json=[],fArr=$api.byId(id),_this,i=0;i<fArr.length;i++)_this=fArr[i],(_this.localName=="textarea"||_this.localName=="select"||_this.localName=="input"&&_this.type!="button"&&_this.type!="submit"&&_this.type!="reset")&&json.push('"'+_this.name+'":"'+$api.val(_this)+'"');return json=json.join(","),eval("({"+json+"})")}},box=new function(){this.target="";this.key="";this.value="";this.arr=[];this.title="";this.opts={show:!1,oper:'<span class="btn-ok" onclick="box.ok()">确 定<\/span>'};this.create=function(){var n;return typeof box.target=="string"&&(n=$api.byId(box.target)||$api.dom(box.target)),n||($api.append($api.dom("body"),'<div class="ui-select" id="'+box.target+'"> <div class="ui-header"> <span class="ui-title"> '+(box.opts.show?box.opts.oper:'<i class="fa fa-win"><\/i>'+box.title)+' <\/span> <span class="ui-close" onclick="box.close()">×<\/span> <\/div> <div class="ui-content"><\/div> <\/div>'),n=$api.byId(box.target)||$api.dom(box.target)),n};this.itemClick=function(n){if(!(box.arr.length<=0)){$api.removeCls(box.arr,"select");$api.text(box.arr,"","this");$api.addCls(n,"select");var t=$api.trim($api.text(n));$api.html(n,'<i class="fa fa-select"><\/i>'+t);search.obj.key=$api.data(n,"id");search.obj.value=t;setTimeout(function(){box.ok()},500)}};this.clear=function(){};this.ok=function(){if(search.obj.value!=""||tree.key.length!=0){if(search.obj.value==""){if(tree.key.length>tree.select.max.cnt){common.tip(eval(tree.select.max.msg));return}search.obj={key:tree.key.join(","),value:tree.value.join(",")};tree.key=[];tree.value=[]}$api.remove($api.dom(".l-mask"));$api.hide(box.target);$api.val(box.key,search.obj.key);$api.val(box.value,search.obj.value);search.obj={key:"",value:""}}};this.open=function(){setTimeout(function(){$api.remove($api.dom(".l-mask"));$api.append($api.dom("body"),'<div class="l-mask" style="display:block;"><\/div>')},100);$api.show(box.target)};this.close=function(){$api.remove($api.dom(".l-mask"));$api.hide(box.target)}},tree=new function(){function n(n,t,i){t=t||!1;i=i||0;t?($api.rmChild(n,".fa-check"),$api.data(n,"check","1"),$api.css(n.children[0],"color:#149b70;"),$api.addRmCls(n,"select","unselect"),i==0&&(tree.key.remove($api.data(n,"code")),tree.value.remove($api.data(n,"fname")))):($api.addRmCls(n,"unselect","select"),$api.rmChild(n,".fa-uncheck"),$api.data(n,"check","0"),$api.after($api.dom(n,".txt"),'<i class="fa fa-check"><\/i>'),$api.css(n.children[0],"color:#fff;"),i==0&&(tree.key.push($api.data(n,"code")),tree.value.push($api.data(n,"fname"))))}this.key=[];this.value=[];this.ajax={url:"/Common/Build",data:""};this.select={max:{cnt:5,msg:"'当前选中 ' + tree.key.length + '个,已超过最大值 ' + tree.select.max.cnt + '个'"}};this.spreadCallback=function(n){var t=$api.data(n,"id"),i=$api.data(n,"check")=="0";tree.ajax.data="estateId="+$api.val("estateId")+"&parentId="+t+"&userId="+req.userId;search.bind.data(tree.ajax.url,tree.ajax.data,"build",n,!0,i)};this.shrink=function(n){var t=event||window.event,i,r;t&&t.stopPropagation?t.stopPropagation():t.cancelBubble=!0;$api.addRmCls(n,"fa-shrink","fa-spread");$api.addRmAttr(n,"onclick","tree.spread(this)");i=n.parentNode;r=$api.data(i,"children");r>=1&&$api.hide(i.children[i.children.length-1])};this.spread=function(n){var i=event||window.event,t,r;if(i&&i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,$api.addRmCls(n,"fa-spread","fa-shrink"),$api.addRmAttr(n,"onclick","tree.shrink(this)"),t=n.parentNode,r=$api.data(t,"children"),r>=1){$api.show(t.children[t.children.length-1]);return}tree.spreadCallback(t)};this.check=function(t){function l(t){for(var i=0;i<t.children.length;i++)n(t.children[i],r,1),e=$api.data(t.children[i],"children")||0,e>=1&&(s=t.children[i].children,l(s[s.length-1]))}function v(t,r){n(t,r);i=t.children[t.children.length-1].children;for(var f=0;f<i.length;f++)$api.hasCls(i[f],"select")&&(tree.key.remove($api.data(i[f],"code")),tree.key.push($api.data(i[f],"code")),tree.value.remove($api.data(i[f],"fname")),tree.value.push($api.data(i[f],"fname")));u=$api.data(t,"type")||"";u!="root"&&v(t.parentNode.parentNode,r)}function p(t,i,r){var f;for(o=!0,f=0;f<r.length;f++)if($api.hasCls(r[f],"unselect")||r[f].className==""){o=!1;break}if(o){for(n(t,i),f=0;f<r.length;f++)tree.key.remove($api.data(r[f],"code")),tree.value.remove($api.data(r[f],"fname"));u=$api.data(t,"type")||"";u!="root"&&(c=t.parentNode.parentNode.children,p(t.parentNode.parentNode,i,c[c.length-1].children))}}var f=event||window.event,r,e,a,s,u,h,i,y,o,c;return(f&&f.stopPropagation?f.stopPropagation():f.cancelBubble=!0,r=$api.data(t,"check")=="0",e=$api.data(t,"children")||0,e>=1&&(a=t.children[t.children.length-1],l(a),tree.key.removeLike($api.data(t,"code")),tree.value.removeLike($api.data(t,"fname"))),n(t,r),u=$api.data(t,"type")||"",u=="root")?!1:(h=t.parentNode.parentNode,r)?(v(h,r),!1):(y=t.parentNode.children,o=!0,p(h,r,y),!1)}},search=new function(){this.obj={key:"",value:""};this.build={parentId:0};this.select={usage:{},city:{},area:{},trade:{}};this.load=function(){search.clear();search.bind.event();form.init();search.select.usage=new Select({title:"用途列表",show:!1,isdft:!1,target:"usage-list",key:"usage",value:"selectUsage",url:"/Common/Usage",data:"id="+req.userId,change:function(){var n=this;search.clear()},callback:function(){$api.attr("selectUsage","value",$api.val("selectUsage"))}});search.select.trade=new Select({title:"交易类型",show:!1,target:"trade-list",key:"tradeType",value:"selectTrade",html:'<li data-id="0" class="select"><i class="fa fa-select"><\/i>全部<\/li><li data-id="1">出售<\/li><li data-id="2">出租<\/li>',change:function(){var t=this,n=$api.val("tradeType");if(n==0||n==1){$api.text("unit","万元");return}$api.text("unit","元/月")}})};this.clear=function(n){switch(n){case"build":$api.val("build","");$api.val("code","");break;case"all":default:$api.val("estate","");$api.val("estateId","0");$api.val("build","");$api.val("code","")}};this.bind={event:function(){$api.addEvt(window,"resize",function(){form.init()});$api.addEvt("btn-adv","click",function(){var r=$api.text(this),n=$api.domAll(".advanced"),t=n.length,i;r=="基本查询>>"?$api.text(this,"高级查询>>"):$api.text(this,"基本查询>>");i=setInterval(function(){if($api.toggleCls(n[--t],"dn"),t<=0){clearInterval(i);return}},100)});$api.addEvt("estate","blur",function(){$api.trim($api.val(this))==""&&search.clear()});$api.addEvt("build","blur",function(){$api.trim($api.val(this))==""&&search.clear("build")});$api.addEvt("build","click",function(){$api.dom(this.parentNode,".fa-query").click()});$api.addEvt("query","click",function(){form.validate("search")&&($api.setStorage("hSearch",form.condition("search")),window.location.href="/Housing/List?userId="+req.userId)});$api.addEvt("reset","click",function(){$api.byId("search").reset()});$api.addEvt($api.domAll(".fa-query"),"click",function(){var r=$api.data(this,"url"),t=$api.data(this,"type"),n="",i;switch(t){case"estate":n="userId="+req.userId+"&usageId="+$api.val("usage")+"&val="+$api.val("estate");box.title="楼盘列表";break;case"build":if(n="userId="+req.userId+"&estateId="+$api.val("estateId")+"&parentId="+search.build.parentId,$api.val("estateId")==""||$api.val("estateId")=="0"){common.tip("请先选择楼盘");return}box.title="";box.opts.show=!0}box.target=$api.data(this,"target");box.key=$api.data(this,"key");box.value=$api.data(this,"value");i=box.create();search.bind.data(r,n,t,$api.dom(i,".ui-content"))});$api.addEvt("selectUsage","click",function(){search.select.usage.show()});$api.addEvt("selectCity","click",function(){if(search.select.city.show){search.select.city.show();return}search.select.city=new Select({title:"城区列表",target:"city-list",select:"0",key:"cityId",value:"selectCity",url:"/Common/City",data:"userId="+req.userId,change:function(){var n=this;search.select.area.clear&&search.select.area.clear();$api.val("areaId",0);$api.val("selectArea","全部")}})});$api.addEvt("selectArea","click",function(){var n=$api.val("cityId");if(n==0){common.tip("请先选择城区 !");return}if(search.select.area.show&&search.select.area.box.arr.length>0){search.select.area.show();return}search.select.area=new Select({title:"片区列表",target:"area-list",select:"0",key:"areaId",value:"selectArea",url:"/Common/Area",data:"userId="+req.userId+"&cityId="+n,change:function(){}})});$api.addEvt("selectTrade","click",function(){search.select.trade.show()})},data:function(n,t,i,r,u,f){common.ajax.post({url:n,data:t,callback:function(n){var o,h;if(n.Status!=0){common.tip(n.Message);return}var e=[],t={},c="child",s;for(o=0;o<n.Obj.Data.length;o++)t=n.Obj.Data[o],i=="build"?(t.ParentId=="0"?(c="root",s=t.Name):s=$api.data(r,"fname")+t.Name,e.push('<li data-id="'+t.Id+'" data-code="'+t.Code+'" data-parentId="'+t.ParentId+'" data-fname="'+s+'" data-type="'+c+'" onclick="tree.check(this)"><i class="fa fa-spread" onclick="tree.spread(this)"><\/i><span class="txt">'+t.Name+"<\/span><\/li>")):e.push('<li data-id="'+t.Key+'" onclick="box.itemClick(this);">'+t.Value+"<\/li>");if(u?($api.append(r,'<ul class="p-d-l-5">'+e.join("")+"<\/ul>"),$api.data(r,"children",n.Obj.Data.length),f&&($api.data(r,"check","1"),tree.check(r),$api.data(r,"check","0"))):$api.html(r,'<ul class="scroll container">'+e.join("")+"<\/ul>"),box.open(),$api.remove($api.dom(".l-mask")),$api.append($api.dom("body"),'<div class="l-mask" style="display:block;"><\/div>'),h=$api.domAll($api.byId(box.target),"li"),h.length==0){box.arr=[];return}box.arr=h}})}}};common.loadCallback=function(){search.load()};
//# sourceMappingURL=Search.min.js.map
